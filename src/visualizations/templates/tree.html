{{define "tree"}}
<style>
    .tree {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 1.5rem;
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        overflow-x: auto;
    }

    .tree-item {
        padding: 0.25rem 0;
        color: #333;
    }

    .tree-dir {
        color: #667eea;
        font-weight: bold;
    }

    .tree-file {
        color: #666;
    }
</style>
<div class="section">
    <h2 class="section-title">üóÇÔ∏è Directory Structure</h2>
    <div class="tree" id="directoryTree"></div>
</div>
<script>
    // Directory Tree
    const treeData = JSON.parse('{{toJSON .Analysis.FileTree}}');
    const treeElement = document.getElementById('directoryTree');
    
    function renderNode(node, prefix = '', isLast = true) {
        if (!node) {
            return '<div class="tree-item">No files to display</div>';
        }

        let html = '';
        const connector = isLast ? '‚îî‚îÄ‚îÄ ' : '‚îú‚îÄ‚îÄ ';
        const extension = isLast ? '    ' : '‚îÇ   ';
        
        if (prefix !== '') {
            if (node.is_dir) {
                html += '<div class="tree-item tree-dir">' + prefix + connector + node.name + '/</div>';
            } else {
                html += '<div class="tree-item tree-file">' + prefix + connector + node.name + '</div>';
            }
        } else {
            // Root node
            html += '<div class="tree-item tree-dir">' + node.name + '/</div>';
        }

        if (node.children && node.children.length > 0) {
            node.children.forEach((child, idx) => {
                const isLastChild = idx === node.children.length - 1;
                const newPrefix = prefix === '' ? '' : prefix + extension;
                html += renderNode(child, newPrefix, isLastChild);
            });
        }

        return html;
    }

    if (treeData) {
        treeElement.innerHTML = renderNode(treeData);
    } else {
        treeElement.innerHTML = '<div class="tree-item">No files to display</div>';
    }
</script>
{{end}}